<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Torri di Hanoi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f5f5f5;
    }

    .game-container {
      max-width: 800px;
      margin: 30px auto;
    }

    .game-board {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      height: 300px;
      position: relative;
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 10px;
      padding: 20px 10px 40px;
    }

    .base {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 20px;
      background: #555;
      border-radius: 4px;
    }

    .tower {
      width: 32%;
      height: 100%;
      position: relative;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
    }

    .pole {
      width: 10px;
      height: 220px;
      background: #444;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 5px;
    }

    .disk {
      height: 25px;
      margin-bottom: 5px;
      background: #0d6efd;
      color: white;
      text-align: center;
      line-height: 25px;
      border-radius: 5px;
      cursor: grab;
      font-size: 14px;
      z-index: 2;
    }

    .move-counter {
      font-weight: bold;
      margin: 20px 0;
    }
  </style>
</head>
<body>

<div class="container game-container">
  <h2 class="text-center">Gioco delle Torri di Hanoi</h2>

  <div class="mb-3">
    <label for="diskCount" class="form-label">Numero di dischi:</label>
    <select class="form-select w-auto" id="diskCount" onchange="startGame()">
      <option value="3" selected>3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>
  </div>

  <div id="moveCounter" class="move-counter">Mosse: 0 (minime: 0)</div>

  <div class="game-board" id="gameBoard">
    <div class="base"></div>
    <div class="tower" id="tower-0" ondrop="drop(event)" ondragover="allowDrop(event)">
      <div class="pole"></div>
    </div>
    <div class="tower" id="tower-1" ondrop="drop(event)" ondragover="allowDrop(event)">
      <div class="pole"></div>
    </div>
    <div class="tower" id="tower-2" ondrop="drop(event)" ondragover="allowDrop(event)">
      <div class="pole"></div>
    </div>
  </div>
</div>

<script>
  let towers, diskCount, minMoves, moveCounter;

  function startGame() {
    diskCount = parseInt(document.getElementById("diskCount").value);
    minMoves = Math.pow(2, diskCount) - 1;
    moveCounter = 0;
    document.getElementById("moveCounter").textContent = `Mosse: 0 (minime: ${minMoves})`;

    // Pulisce torri
    towers = [
      document.getElementById("tower-0"),
      document.getElementById("tower-1"),
      document.getElementById("tower-2")
    ];

    towers.forEach(tower => {
      [...tower.querySelectorAll('.disk')].forEach(d => d.remove());
    });

    // Crea dischi
    for (let i = diskCount; i >= 1; i--) {
      const disk = document.createElement("div");
      disk.className = "disk";
      disk.draggable = true;
      disk.id = "disk-" + i;
      disk.dataset.size = i;
      disk.textContent = i;
      disk.style.width = (60 + i * 30) + "px";
      disk.ondragstart = drag;
      towers[0].appendChild(disk);
    }
  }

  function updateCounter() {
    document.getElementById("moveCounter").textContent = `Mosse: ${moveCounter} (minime: ${minMoves})`;
  }

  function allowDrop(ev) {
    ev.preventDefault();
  }

  function drag(ev) {
    const disk = ev.target;
    const parent = disk.parentElement;
    const topDisk = parent.querySelector(".disk:last-child");
    if (disk !== topDisk) {
      ev.preventDefault();
      return;
    }
    ev.dataTransfer.setData("text/plain", disk.id);
  }

  function drop(ev) {
    ev.preventDefault();
    const diskId = ev.dataTransfer.getData("text");
    const disk = document.getElementById(diskId);
    const targetTower = ev.currentTarget;
    const disks = targetTower.querySelectorAll(".disk");
    const topDisk = disks[disks.length - 1];

    if (!topDisk || parseInt(disk.dataset.size) < parseInt(topDisk.dataset.size)) {
      targetTower.appendChild(disk);
      moveCounter++;
      updateCounter();
      checkWin();
    } else {
      alert("Mossa non valida: non puoi mettere un disco piÃ¹ grande sopra uno piÃ¹ piccolo.");
    }
  }

  function checkWin() {
    if (towers[2].querySelectorAll('.disk').length === diskCount) {
      setTimeout(() => {
        alert(`ðŸŽ‰ Hai vinto in ${moveCounter} mosse! (Minime: ${minMoves})`);
      }, 100);
    }
  }

  // Avvia il gioco alla prima apertura
  document.addEventListener("DOMContentLoaded", startGame);
</script>

</body>
</html>
